---
title: "{{< var title >}}: {{< var version >}}"
subtitle: "Summary"
author: "{{< var author.name >}}"
date: "`r Sys.Date()`"
format:
  html: default
  pdf: 
    documentclass: scrreprt
    fontfamily: libertinus
    include-in-header:
       - packages.tex
tbl-cap-location: bottom
execute:
  echo: false
---

```{r}
#| label: setup
#| include: false

# Load libs
library("knitr")
library("here")

# Load small data
source(here::here("scripts", "99_small_data.R"))

# Determine output
yes_no <- function(affirm = TRUE) {
  is_tex <- knitr::is_latex_output()
  if (is_tex == FALSE) { 
    if (affirm == TRUE) {
      out <- emojifont::emoji("thumbsup")
      return(out)
    } else {
      out <- emojifont::emoji("thumbsdown")
      return(out)
    }
  } else {
    if (affirm == TRUE) {
      return("\\ding{51}")
    } else {
      return("\\ding{55}")
    }
  }
}

```


\clearpage

## Take-aways

- The two bilingual groups are essentially equivalent regarding proficiency and use.
- Stress matters: Monolinguals always predict, bilinguals do to some degree, but depends on stress (holding use and proficiency constant)
  - HL: 
    - Paroxytone (CANta) (most common): `r yes_no(T)`
    - Oxytone (canTA) (less common): `r yes_no(F)`
  - L2: 
    - Paroxytone (CANta) (most common): `r yes_no(T)`
    - Oxytone (canTA) (less common): `r yes_no(T)`
- Group differences
  - Monolingual time course different from both bilingual groups (they predict sooner) regardless of stress
  - HL and L2ers have essentially the same time course with paroxytonic stress, but L2 course is slightly delayed in comparison, the opposite is true for oxytonic stress, i.e., the HL time course is slightly delayed
  - L2ers predict more than HL with (less common) oxytonic stress pattern (but still not a lot)
- Proficiency, use, and prediction
  - HL
    - High use individuals always predict in paroxytone condition. 
    - As use decreases, so does prediction
    - Marginalizing over stress, prediction is pretty good across the board
    - For oxytonic stress condition, only high use/high prof individuals predict
    - Unexplained weirdness... in oxytone condition low prof/low use predicts higher (not sure about this)
  - L2
    - Generally use is less important
    - Higher proficiency associated with higher prediction
    - Lowest overall prediction in paroxytone condition

\clearpage

## Key plots

### Prof/use check

See [Proficiency/use cleaup and EDA](https://www.jvcasillas.com/morph_pred_hs/scripts/02_eda_prof_use.html) for full details. 
`r xfun::numbers_to_words(subject_stuff$n_removed, cap = T)` of `r subject_stuff$n_total` participants removed to make *use* more comparable between groups. 

```{r}
#| label: prof-use-eda
#| out.width: "100%"
#| fig.height: 3.5
#| fig.cap: "Estimated marginal mean difference between HL and L2 groups for standardized *use* and *proficiency*. The blue vertical bar represents a region of practical equivalence (ROPE) of &pm;0.1."
include_graphics(
  here("docs", "scripts", "02_eda_prof_use_files", "figure-html", 
    "eda-prof-use-models-1.png")
)
```

\clearpage

### Eye-tracking: Raw data

```{r}
#| label: raw-et-data
#| out.width: "100%"
#| fig.height: 3.5
#| fig.cap: "Time course of raw target fixation data as a function of stress condition (paroxytone, oxytone) for monolingual, HL, and L2 groups. Transparent ribbons represent 99% bootstrapped confidence intervals."
include_graphics(
  here("docs", "scripts", "03_tidy_eyetracking_data_files", "figure-html", 
    "checks-fixes-1.png")
)
```

\clearpage

### Eye-tracking: Group model (no prof/use)

#### Time course: GAMMs

```{r}
#| label: group-comparison-plot
#| out.width: "100%"
#| fig.height: 3.5
#| fig.cap: "Probability of fixating on target as a function of stress for all three groups. The time course is centered around the target syllable offset (point 0). Vertical lines represent 200ms after target syllable offset. Lines represent group trajectories plus 95%, 80%, and 50% credible intervals."
include_graphics(
  here("docs", "scripts", "05_gamms_files", "figure-html", 
    "group-comparison-plot-1.png")
)
```

\clearpage

```{r}
#| label: group-diff-smooths-plot
#| out.width: "100%"
#| fig.height: 6
#| fig.cap: "Pairwise difference smooths for paroxytone and oxytone items. From dark to light, colors represent 95%, 80%, 70%, 60%, 50%, 35% and 10% credible intervals."
include_graphics(
  here("docs", "scripts", "05_gamms_files", "figure-html", 
    "group-diff-smooths-plot-1.png")
)
```

\clearpage

#### Prediction at target offset

```{r}
#| label: group-prediction-plot
#| out.width: "100%"
#| fig.height: 3.5
#| fig.cap: "Proportion of target fixations 200ms after the offset of 1st syllable for monolinguals, heritage learners, and L2 learners in paroxytone (*CANto*) and oxytone (*canTO*) conditions. The vertical dotted line marks chance (50%) surrounded by a &pm;1% region of practical equivalence (ROPE). Density mass of the posterior distribution that falls within the ROPE is discolored (pinkish)."
include_graphics(
  here("docs", "scripts", "05_gamms_files", "figure-html", 
    "group-prediction-plot-1.png")
)
```

\clearpage

### Bilinguals only (prof/use)

#### Time course: GAMMs

```{r}
#| label: bi-comparison-plot
#| out.width: "100%"
#| fig.height: 6
#| fig.cap: "Probability of fixating on target as a function of stress for the bilingual groups. The time course is centered around the target syllable offset (point 0). Vertical lines represent 200ms after target syllable offset. Lines represent paroxytone ('CANta', green) and oxytone ('canTO', orange) conditions plus 95%, 80%, and 50% credible intervals. Pairwise difference smooths for paroxytone and oxytone items. From dark to light, colors represent 95%, 80%, 70%, 60%, 50%, 35% and 10% credible intervals."
include_graphics(
  here("docs", "scripts", "05_gamms_files", "figure-html", 
    "bi-comparison-plot-1.png")
)
```

\clearpage

#### Prediction at target offset: ZOIDBERG

```{r}
#| label: bi-prof-use-heatmap
#| out.width: "100%"
#| fig.height: 6
#| fig.cap: "Heatmap of target fixations 200ms after target syllable offset. The heatmap illustrates the conditional effects of normalized proficiency and use scores for the bilingual groups. The top rows illustrate model estimate for the paroxytone condtion, the middle rows marginalize over stress conditions, and the bottom rows represent model estimate for the oxytone condition."
include_graphics(
  here("docs", "scripts", "05_gamms_files", "figure-html", 
    "bi-prof-use-heatmap-1.png")
)
```

\clearpage

## Write-up

### Method

#### Participants

We included data from `r subject_stuff$n_final` individuals for analysis. 
There were `r pull_from_tib(subject_stuff$n_group, group, "Monolingual", n)` monolingual participants, `r pull_from_tib(subject_stuff$n_group, group, "HL", n)` heritage speakers, and `r pull_from_tib(subject_stuff$n_group, group, "L2", n)` adult L2 learners. 

The bilingual participants completed language *use* and *proficiency* assessments. 
We fit the *use* and *proficiency* data to separate Bayesian linear models to assess potential group differences. 
In both cases, the response variable, use or proficiency score, was a proportion. 
Thus, we used the beta distribution for the model likelihood with a logit linking function. 
The models included regularizing, weakly informative priors.^[See [Proficiency/use cleaup and EDA](https://www.jvcasillas.com/morph_pred_hs/scripts/02_eda_prof_use.html) for full details.] 
We compare the posterior marginal mean difference between groups on both response variables. 
We established a region of practical equivalence (ROPE) of Â±0.1. 
If, for a given measure, the full range of the 95% highest density interval of the difference estimate falls within the ROPE, we consider there to be compelling evidence that the groups are equivalent. 
The HL group had an average proficiency score of `r pull_from_tib(prof_use_desc, Group, "HL", Proficiency)` compared to the L2 groups' score of `r pull_from_tib(prof_use_desc, Group, "L2", Proficiency)`. 
The marginal mean difference was `r pull_from_tib(prof_use_mod, Metric, "Proficiency", Estimate)` and all of the HDI fell within the ROPE. 
The probability that the effect was positive was `r pull_from_tib(prof_use_mod, Metric, "Proficiency", PD)`. 
Regarding language use, the HL group had an average score of `r pull_from_tib(prof_use_desc, Group, "HL", Use)` compared to the L2 groups' score of `r pull_from_tib(prof_use_desc, Group, "L2", Use)`. 
The marginal mean difference was `r pull_from_tib(prof_use_mod, Metric, "Use", Estimate)` and, again, all of the HDI fell within the ROPE. 
The probability that the effect was negative was `r pull_from_tib(prof_use_mod, Metric, "Use", PD)`. 
Taken together, we are confident that the groups do not differ in any meaningful way with regard to use of/proficiency in Spanish.
@tbl-prof-use-desc provides descriptive statistics and @tbl-prof-use-mod  summarizes the models. 


```{r}
#| label: tbl-prof-use-desc
#| tbl-cap: "Language use and proficiency assessments for the bilingual groups. Descriptive summary. Mean plus standard deviation of use and proficiency."
prof_use_desc %>% 
  knitr::kable(format = "pandoc", align = c("l", "r", "r", "r"))
```

```{r}
#| label: tbl-prof-use-mod
#| tbl-cap: "Language use and proficiency assessments for the bilingual groups. Model summary. Posterior estimates of the marginal mean difference (L2 - HL) for use and proficiency values. The proportion of the posterior density falling within the region of practical equivalence is reported in the ROPE column. The probability that the effect is of the medians sign is reported in the PD column."
prof_use_mod %>% 
  knitr::kable(format = "markdown", align = c("l", "l", "r", "r", "r"))
```

