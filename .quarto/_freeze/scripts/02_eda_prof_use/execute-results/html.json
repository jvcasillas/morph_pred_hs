{
  "hash": "c5113ee9097be86b4b7c81af0ed0ed1c",
  "result": {
    "markdown": "---\ntitle: \"{{< var title >}}: {{< var version >}}\"\nsubtitle: \"EDA - proficiency/use\"\nauthor: \"{{< var author.name >}}\"\ndate: \"2022-05-15\"\nformat:\n  html: default\n  pdf: default\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"scripts\", \"00_libraries.R\"))\nsource(here::here(\"scripts\", \"01_helpers.R\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprof_use_temp <- read_xlsx(\n  here(\"data\", \"raw\",  \"HS_L2_used_blc_V2.xlsx\")\n  ) %>% \n  rename(id = Participant, prof = dele, use = `span_week_%`)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create heritage and L2 groups \n# Standardize proficiency\nprof_use <- prof_use_temp %>% \n  mutate(group = case_when(\n    Type == \"advanced_heritage\" ~ \"hl\", \n    Type == \"intermediate_heritage\" ~ \"hl\", \n    TRUE ~ \"l2\"), \n    prof_p = prof / 56, \n    use_p = use / 100, \n    prof_perc = prof_p * 100, \n    use_perc = use_p * 100, \n    prof_z = (prof_perc - mean(prof_perc)) / sd(prof_perc), \n    use_z = (use_perc - mean(use_perc)) / sd(use_perc)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprof_use %>% \n  ggplot(., aes(x = use_p, y = prof_p, color = group)) + \n    geom_point() + \n    coord_cartesian(ylim = c(0,1), xlim = c(0, 1))\n```\n\n::: {.cell-output-display}\n![](02_eda_prof_use_files/figure-html/eda-prof-use-plots-1.png){width=672}\n:::\n:::\n\nIt looks pretty evenly distributed, though perhaps there is more variability in the L2 group. \n\n::: {.cell}\n\n```{.r .cell-code}\n# Check mean (SD) for each TYPE\nprof_use %>% \n  group_by(Type) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 4 × 5\n  Type                  prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>                       <dbl>     <dbl>      <dbl>    <dbl>\n1 advanced_heritage           0.776    0.0450      0.474    0.169\n2 advanced_l2                 0.823    0.0775      0.437    0.134\n3 intermediate_heritage       0.609    0.0633      0.421    0.185\n4 intermediate_l2             0.591    0.0780      0.307    0.167\n```\n:::\n\n```{.r .cell-code}\n# Might be able to balance groups by removing intermediate \n# heritage with high use\nprof_use %>% \n  filter(Type == \"intermediate_heritage\") %>% \n  arrange(desc(use_p))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 × 11\n   Type     id     prof   use group prof_p use_p prof_perc use_perc prof_z use_z\n   <chr>    <chr> <dbl> <dbl> <chr>  <dbl> <dbl>     <dbl>    <dbl>  <dbl> <dbl>\n 1 interme… ihs24    27    75 hl     0.482  0.75      48.2       75 -1.76  1.98 \n 2 interme… ihs13    30    70 hl     0.536  0.7       53.6       70 -1.32  1.69 \n 3 interme… ihs18    31    70 hl     0.554  0.7       55.4       70 -1.18  1.69 \n 4 interme… ihs06    28    60 hl     0.5    0.6       50         60 -1.61  1.11 \n 5 interme… ihs27    31    60 hl     0.554  0.6       55.4       60 -1.18  1.11 \n 6 interme… ihs02    37    50 hl     0.661  0.5       66.1       50 -0.307 0.539\n 7 interme… ihs04    33    50 hl     0.589  0.5       58.9       50 -0.888 0.539\n 8 interme… ihs09    33    50 hl     0.589  0.5       58.9       50 -0.888 0.539\n 9 interme… ihs10    37    50 hl     0.661  0.5       66.1       50 -0.307 0.539\n10 interme… ihs11    36    50 hl     0.643  0.5       64.3       50 -0.452 0.539\n# … with 14 more rows\n```\n:::\n\n```{.r .cell-code}\n# There are three in the 70+ % range\n# We'll start there\nprof_use %>% \n  filter(!(id %in% c(\"ihs24\", \"ihs13\", \"ihs18\"))) %>% \n  group_by(Type) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 4 × 5\n  Type                  prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>                       <dbl>     <dbl>      <dbl>    <dbl>\n1 advanced_heritage           0.776    0.0450      0.474    0.169\n2 advanced_l2                 0.823    0.0775      0.437    0.134\n3 intermediate_heritage       0.622    0.0566      0.379    0.155\n4 intermediate_l2             0.591    0.0780      0.307    0.167\n```\n:::\n\n```{.r .cell-code}\n# They are closer now. We can also take out a few of the lower L2 use\nprof_use %>% \n  filter(Type == \"intermediate_l2\") %>% \n  arrange(use_p)\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 27 × 11\n   Type    id     prof   use group prof_p use_p prof_perc use_perc  prof_z use_z\n   <chr>   <chr> <dbl> <dbl> <chr>  <dbl> <dbl>     <dbl>    <dbl>   <dbl> <dbl>\n 1 interm… ies09    32    15 l2     0.571  0.15      57.1       15 -1.03   -1.48\n 2 interm… ies26    39    15 l2     0.696  0.15      69.6       15 -0.0160 -1.48\n 3 interm… ies29    26    15 l2     0.464  0.15      46.4       15 -1.90   -1.48\n 4 interm… ies05    35    20 l2     0.625  0.2       62.5       20 -0.597  -1.19\n 5 interm… ies06    37    20 l2     0.661  0.2       66.1       20 -0.307  -1.19\n 6 interm… ies07    35    20 l2     0.625  0.2       62.5       20 -0.597  -1.19\n 7 interm… ies12    26    20 l2     0.464  0.2       46.4       20 -1.90   -1.19\n 8 interm… ies13    39    20 l2     0.696  0.2       69.6       20 -0.0160 -1.19\n 9 interm… ies20    35    20 l2     0.625  0.2       62.5       20 -0.597  -1.19\n10 interm… ies21    29    20 l2     0.518  0.2       51.8       20 -1.47   -1.19\n# … with 17 more rows\n```\n:::\n\n```{.r .cell-code}\n# There are three in the 15% range\n# We'll start there\nprof_use %>% \n  filter(!(id %in% c(\"ihs24\", \"ihs13\", \"ihs18\")), \n         !(id %in% c(\"ies09\", \"ies26\", \"ies29\"))) %>% \n  group_by(Type) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 4 × 5\n  Type                  prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>                       <dbl>     <dbl>      <dbl>    <dbl>\n1 advanced_heritage           0.776    0.0450      0.474    0.169\n2 advanced_l2                 0.823    0.0775      0.437    0.134\n3 intermediate_heritage       0.622    0.0566      0.379    0.155\n4 intermediate_l2             0.592    0.0753      0.327    0.167\n```\n:::\n\n```{.r .cell-code}\nprof_use %>% \n  filter(Type == \"advanced_heritage\") %>% \n  arrange(desc(use_p))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 23 × 11\n   Type     id     prof   use group prof_p use_p prof_perc use_perc prof_z use_z\n   <chr>    <chr> <dbl> <dbl> <chr>  <dbl> <dbl>     <dbl>    <dbl>  <dbl> <dbl>\n 1 advance… ahs12    43    80 hl     0.768  0.8       76.8       80  0.565 2.27 \n 2 advance… ahs03    47    75 hl     0.839  0.75      83.9       75  1.15  1.98 \n 3 advance… ahs15    45    70 hl     0.804  0.7       80.4       70  0.856 1.69 \n 4 advance… ahs23    45    70 hl     0.804  0.7       80.4       70  0.856 1.69 \n 5 advance… ahs04    46    60 hl     0.821  0.6       82.1       60  1.00  1.11 \n 6 advance… ahs11    44    60 hl     0.786  0.6       78.6       60  0.710 1.11 \n 7 advance… ahs16    44    60 hl     0.786  0.6       78.6       60  0.710 1.11 \n 8 advance… ahs02    43    50 hl     0.768  0.5       76.8       50  0.565 0.539\n 9 advance… ahs06    47    50 hl     0.839  0.5       83.9       50  1.15  0.539\n10 advance… ahs10    44    50 hl     0.786  0.5       78.6       50  0.710 0.539\n# … with 13 more rows\n```\n:::\n\n```{.r .cell-code}\nprof_use %>% \n  filter(!(id %in% c(\"ihs24\", \"ihs13\", \"ihs18\")), \n         !(id %in% c(\"ahs12\", \"ahs03\")), \n         !(id %in% c(\"ies09\", \"ies26\", \"ies29\"))) %>% \n  group_by(group) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 2 × 5\n  group prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>       <dbl>     <dbl>      <dbl>    <dbl>\n1 hl          0.698    0.0921      0.412    0.153\n2 l2          0.712    0.139       0.384    0.159\n```\n:::\n\n```{.r .cell-code}\n# IDs to drop\nremove <- c(\n  \"ihs24\", \"ihs13\", \"ihs18\", \n  \"ahs12\", \"ahs03\", \n  \"ies09\", \"ies26\", \"ies29\"\n  )\n\nprof_use_final <- prof_use %>% \n  filter(!(id %in% remove)) %>% \n  mutate(prof_z = (prof_perc - mean(prof_perc)) / sd(prof_perc), \n    use_z = (use_perc - mean(use_perc)) / sd(use_perc))\n```\n:::\n\nWe now have candidates to remove. \nWe will do a few formal tests to look at equivalence in proficiency and use with and without them. \n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit models will all participants\n\nmodel_formula <- bf(\n  prop ~ group, \n  phi  ~ group \n  )\n\nprof_with <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use, prop = prof / 56), \n  file = here(\"models\", \"eda_prof_use\", \"prof_with\")\n  )\n\nuse_with <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use, prop = use / 100), \n  file = here(\"models\", \"eda_prof_use\", \"use_with\")\n  )\n\nprof_wo <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use_final, prop = prof / 56), \n  file = here(\"models\", \"eda_prof_use\", \"prof_wo\")\n  )\n\nuse_wo <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use_final, prop = use / 100), \n  file = here(\"models\", \"eda_prof_use\", \"use_wo\")\n  )\n\nprof_contrast <- prof_wo %>% \n  emmeans(spec = ~ group, \n    at = list(group = c(\"l2\", \"hl\")), \n    epred = TRUE) %>% \n  contrast(method = \"pairwise\") %>% \n  gather_emmeans_draws() %>% \n  mutate(metric = \"prof\")\n\nuse_contrast <- use_wo %>% \n  emmeans(spec = ~ group, \n    at = list(group = c(\"l2\", \"hl\")), \n    epred = TRUE) %>% \n  contrast(method = \"pairwise\") %>% \n  gather_emmeans_draws() %>% \n  mutate(metric = \"use\")\n\nuse_prof_desc <- bind_rows(\n  bind_cols(x = 0.15, y = 1.2, \n    metric = \"Proficiency\", \n    median_hdi(prof_contrast, .value), \n    ROPE = rope(prof_contrast$.value, ci_method = \"HDI\")$ROPE_Percentage,\n    PD = p_direction(prof_contrast$.value)[[1]]\n    ), \n  bind_cols(x = -0.3, y = 2.2, \n    metric = \"Use\", \n    median_hdi(use_contrast, .value), \n    ROPE = rope(use_contrast$.value, ci_method = \"HDI\")$ROPE_Percentage,\n    PD = p_direction(use_contrast$.value)[[1]]\n    )\n  ) %>% \n  mutate(across(c(\".value\", \".lower\", \".upper\", \"PD\"), \n    ~ round(.x, digits = 2))) %>% \n  transmute(x, y, metric, contrast, \n    out = glue(\"β = {.value} [{.lower}, {.upper}]\\nPD = {PD}, ROPE = {ROPE}\"))\n\nbind_rows(prof_contrast, use_contrast) %>% \n  mutate(ylab = if_else(metric == \"use\", \"Use\", \"Proficiency\")) %>% \n  ggplot(., aes(x = .value, y = ylab, fill = stat(abs(x) > 0.1))) + \n    geom_tile(data = tibble(\n      ylab = \"Proficiency\", value = 0, lower = -0.1, upper = 0.1\n      ),\n      aes(x = value, width = lower - upper),\n      alpha = 0.1, height = Inf, fill = \"#31688EFF\") +\n    stat_dotsinterval(quantiles = 100, point_interval = \"median_hdi\", \n      show.legend = F, pch = 21, point_fill = \"white\") +\n    scale_fill_manual(values = c(\"grey\", \"#cc0033\")) + \n    coord_cartesian(xlim = c(-0.3, 0.3)) + \n    geom_text(data = use_prof_desc, aes(x = x, y = y, label = out), \n      hjust = 0, size = 3) +\n    labs(y = NULL, x = \"Marginal mean difference\\n(L2 - HL)\") + \n    theme(axis.text.y = element_text(angle = 90, hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](02_eda_prof_use_files/figure-html/eda-prof-use-models-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nn_groups <- prof_use_final %>% \n  group_by(group) %>% \n  summarize(n = n_distinct(id))\n\ntab_prof_use_desc <- prof_use_final %>% \n  group_by(group) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd))) %>% \n  mutate_if(is.numeric, specify_decimal, k = 2) %>% \n  left_join(., n_groups, by = \"group\") %>% \n  mutate(Proficiency = glue(\"{prof_p_mean} [{prof_p_sd}]\"), \n    Use = glue(\"{use_p_mean} [{use_p_sd}]\")) %>% \n  transmute(Group = group, n, Proficiency, Use) %>% \n  mutate(Group = str_to_upper(Group)) %>% \n  write_csv(here(\"tables\", \"tab_prof_use_desc.csv\"))\n\ntab_prof_use_desc %>% \n  knitr::kable(format = \"pandoc\", \n    align = c(\"l\", \"r\", \"r\", \"r\"), \n    caption = \"Average use and proficiency for L2 and heritage learners.\")\n```\n\n::: {.cell-output-display}\nTable: Average use and proficiency for L2 and heritage learners.\n\nGroup     n   Proficiency           Use\n------  ---  ------------  ------------\nHL       42   0.70 [0.09]   0.41 [0.15]\nL2       50   0.71 [0.14]   0.38 [0.16]\n:::\n\n```{.r .cell-code}\ntab_use_prof_desc_mod <- use_prof_desc %>% \n  select(metric:out) %>% \n  separate(out, into = c(\"HDI\", \"PD\"), sep = \"\\n\") %>% \n  separate(PD, into = c(\"PD\", \"ROPE\"), sep = \",\") %>% \n  mutate(contrast = str_to_upper(contrast), \n    HDI = str_remove(HDI, \"β = \"), \n    HDI = str_replace_all(HDI, \"-\", \"\\U2212\"), \n    PD = str_remove(PD, \"PD = \"), \n    ROPE = str_remove(ROPE, \"ROPE = \"), \n    ROPE = str_remove(ROPE, \" \")) %>% \n  select(Metric = metric, Contrast = contrast, HDI:ROPE) %>% \n  write_csv(here(\"tables\", \"tab_prof_use_mod.csv\"))\n\ntab_use_prof_desc_mod %>% \n  knitr::kable(format = \"pandoc\", \n    align = c(\"l\", \"l\", \"r\", \"r\", \"r\"), \n    caption = \"Marginal mean difference beween L2 and heritage leareners for use and proficiency.\")\n```\n\n::: {.cell-output-display}\nTable: Marginal mean difference beween L2 and heritage leareners for use and proficiency.\n\nMetric        Contrast                    HDI     PD   ROPE\n------------  ---------  --------------------  -----  -----\nProficiency   L2 - HL      0.02 [−0.03, 0.07]   0.77      1\nUse           L2 - HL     −0.02 [−0.09, 0.05]   0.72      1\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprof_use %>% \n  mutate(remove = if_else(id %in% remove, 1, 0)) %>% \n  write_csv(here(\"data\", \"tidy\", \"prof_use.csv\"))\n```\n:::\n",
    "supporting": [
      "02_eda_prof_use_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": [],
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}