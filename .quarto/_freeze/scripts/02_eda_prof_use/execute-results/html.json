{
  "hash": "08f15831725ff8fb7a10a80e889c9f26",
  "result": {
    "markdown": "---\ntitle: \"{{< var title >}}: {{< var version >}}\"\nsubtitle: \"EDA - proficiency/use\"\nauthor: \"{{< var author.name >}}\"\ndate: \"2023-04-03\"\nformat: \n  html: default\n  pdf: default\nnumber-sections: false\nexecute: \n  echo: true\n  warning: false\n  message: false\n  fig.retina: 2\n---\n\n\n### Setup\n\nLoad libraries and helper functions: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"scripts\", \"00_libraries.R\"))\nsource(here::here(\"scripts\", \"01_helpers.R\"))\n```\n:::\n\n\nLoad proficiency and use data: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nprof_use_temp <- read_xlsx(\n  here(\"data\", \"raw\",  \"HS_L2_used_blc_V2.xlsx\")\n  ) %>% \n  rename(id = Participant, prof = dele, use = `span_week_%`)\n```\n:::\n\n\nNext, we tidy the data and convert to z-scores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create heritage and L2 groups \n# Standardize proficiency\nprof_use <- prof_use_temp %>% \n  mutate(group = case_when(\n    Type == \"advanced_heritage\" ~ \"hl\", \n    Type == \"intermediate_heritage\" ~ \"hl\", \n    TRUE ~ \"l2\"), \n    prof_p = prof / 56, \n    use_p = use / 100, \n    prof_perc = prof_p * 100, \n    use_perc = use_p * 100, \n    prof_z = (prof_perc - mean(prof_perc)) / sd(prof_perc), \n    use_z = (use_perc - mean(use_perc)) / sd(use_perc)\n  )\n```\n:::\n\n\nBasic plot to check distributions. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nprof_use %>% \n  ggplot(., aes(x = use_p, y = prof_p, color = group)) + \n    geom_point() + \n    scale_color_viridis_d(option = \"A\", begin = 0.3, end = 0.85)\n```\n\n::: {.cell-output-display}\n![](../figs/eda-prof-use-plots-1.png){width=672}\n:::\n:::\n\n\nThe data look pretty evenly distributed, though perhaps there is more variability in the L2 group. \nNow we will look at some descriptives in order to get a sense of whether or not there are any individuals that might make the groups uneven.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check mean (SD) for each TYPE\nprof_use %>% \n  group_by(Type) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n\n# Might be able to balance groups by removing intermediate \n# heritage with high use\nprof_use %>% \n  filter(Type == \"intermediate_heritage\") %>% \n  arrange(desc(use_p)) %>% \n  select(id, prof_p, use_p)\n\n# There are three in the 70+ % range\n# We'll start there\nprof_use %>% \n  filter(!(id %in% c(\"ihs24\", \"ihs13\", \"ihs18\"))) %>% \n  group_by(Type) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n\n# They are closer now. We can also take out a few of the lower L2 use\nprof_use %>% \n  filter(Type == \"intermediate_l2\") %>% \n  arrange(use_p) %>% \n  select(id, prof_p, use_p)\n\n# There are three in the 15% range\n# We'll start there\nprof_use %>% \n  filter(!(id %in% c(\"ihs24\", \"ihs13\", \"ihs18\")), \n         !(id %in% c(\"ies09\", \"ies26\", \"ies29\"))) %>% \n  group_by(Type) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n\nprof_use %>% \n  filter(Type == \"advanced_heritage\") %>% \n  arrange(desc(use_p)) %>% \n  select(id, prof_p, use_p)\n\n\nprof_use %>%   filter(!(id %in% c(\"ihs24\", \"ihs13\", \"ihs18\")), \n         !(id %in% c(\"ahs12\", \"ahs03\")), \n         !(id %in% c(\"ies09\", \"ies26\", \"ies29\"))) %>% \n  group_by(group) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd)))\n\n# IDs to drop\nremove <- c(\n  \"ihs24\", \"ihs13\", \"ihs18\", \n  \"ahs12\", \"ahs03\", \n  \"ies09\", \"ies26\", \"ies29\"\n  )\n\nprof_use_final <- prof_use %>% \n  filter(!(id %in% remove)) %>% \n  mutate(prof_z = (prof_perc - mean(prof_perc)) / sd(prof_perc), \n    use_z = (use_perc - mean(use_perc)) / sd(use_perc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  Type                  prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>                       <dbl>     <dbl>      <dbl>    <dbl>\n1 advanced_heritage           0.776    0.0450      0.474    0.169\n2 advanced_l2                 0.823    0.0775      0.437    0.134\n3 intermediate_heritage       0.609    0.0633      0.421    0.185\n4 intermediate_l2             0.591    0.0780      0.307    0.167\n# A tibble: 24 × 3\n   id    prof_p use_p\n   <chr>  <dbl> <dbl>\n 1 ihs24  0.482  0.75\n 2 ihs13  0.536  0.7 \n 3 ihs18  0.554  0.7 \n 4 ihs06  0.5    0.6 \n 5 ihs27  0.554  0.6 \n 6 ihs02  0.661  0.5 \n 7 ihs04  0.589  0.5 \n 8 ihs09  0.589  0.5 \n 9 ihs10  0.661  0.5 \n10 ihs11  0.643  0.5 \n# ℹ 14 more rows\n# A tibble: 4 × 5\n  Type                  prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>                       <dbl>     <dbl>      <dbl>    <dbl>\n1 advanced_heritage           0.776    0.0450      0.474    0.169\n2 advanced_l2                 0.823    0.0775      0.437    0.134\n3 intermediate_heritage       0.622    0.0566      0.379    0.155\n4 intermediate_l2             0.591    0.0780      0.307    0.167\n# A tibble: 27 × 3\n   id    prof_p use_p\n   <chr>  <dbl> <dbl>\n 1 ies09  0.571  0.15\n 2 ies26  0.696  0.15\n 3 ies29  0.464  0.15\n 4 ies05  0.625  0.2 \n 5 ies06  0.661  0.2 \n 6 ies07  0.625  0.2 \n 7 ies12  0.464  0.2 \n 8 ies13  0.696  0.2 \n 9 ies20  0.625  0.2 \n10 ies21  0.518  0.2 \n# ℹ 17 more rows\n# A tibble: 4 × 5\n  Type                  prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>                       <dbl>     <dbl>      <dbl>    <dbl>\n1 advanced_heritage           0.776    0.0450      0.474    0.169\n2 advanced_l2                 0.823    0.0775      0.437    0.134\n3 intermediate_heritage       0.622    0.0566      0.379    0.155\n4 intermediate_l2             0.592    0.0753      0.327    0.167\n# A tibble: 23 × 3\n   id    prof_p use_p\n   <chr>  <dbl> <dbl>\n 1 ahs12  0.768  0.8 \n 2 ahs03  0.839  0.75\n 3 ahs15  0.804  0.7 \n 4 ahs23  0.804  0.7 \n 5 ahs04  0.821  0.6 \n 6 ahs11  0.786  0.6 \n 7 ahs16  0.786  0.6 \n 8 ahs02  0.768  0.5 \n 9 ahs06  0.839  0.5 \n10 ahs10  0.786  0.5 \n# ℹ 13 more rows\n# A tibble: 2 × 5\n  group prof_p_mean prof_p_sd use_p_mean use_p_sd\n  <chr>       <dbl>     <dbl>      <dbl>    <dbl>\n1 hl          0.698    0.0921      0.412    0.153\n2 l2          0.712    0.139       0.384    0.159\n```\n:::\n:::\n\n\nWe now have a few candidates. \nWe will do a few formal tests to look at equivalence in proficiency and use with and without them. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#\n# Fit models\n#\n\n# model formula\nmodel_formula <- bf(\n  prop ~ group, \n  phi  ~ group \n  )\n\n# Fit proficiency model with all data\nprof_with <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use, prop = prof / 56), \n  file = here(\"models\", \"eda_prof_use\", \"prof_with\")\n  )\n\n# Fit use model with all data\nuse_with <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use, prop = use / 100), \n  file = here(\"models\", \"eda_prof_use\", \"use_with\")\n  )\n\n# Fit proficiency model remove a few participants\nprof_wo <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use_final, prop = prof / 56), \n  file = here(\"models\", \"eda_prof_use\", \"prof_wo\")\n  )\n\n# Fit use model remove a few participants\nuse_wo <- brm(\n  formula = model_formula, \n  family = Beta(), \n  data = mutate(prof_use_final, prop = use / 100), \n  file = here(\"models\", \"eda_prof_use\", \"use_wo\")\n  )\n```\n:::\n\n\nNow we can check the marginal mean estimates to see how the groups compare. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get marginal mean estimates for prof with ids removed\nprof_contrast <- prof_wo %>% \n  emmeans(spec = ~ group, \n    at = list(group = c(\"l2\", \"hl\")), \n    epred = TRUE) %>% \n  contrast(method = \"pairwise\") %>% \n  gather_emmeans_draws() %>% \n  mutate(metric = \"prof\")\n\n# Get marginal mean estimates for use with ids removed\nuse_contrast <- use_wo %>% \n  emmeans(spec = ~ group, \n    at = list(group = c(\"l2\", \"hl\")), \n    epred = TRUE) %>% \n  contrast(method = \"pairwise\") %>% \n  gather_emmeans_draws() %>% \n  mutate(metric = \"use\")\n\nuse_prof_desc <- bind_rows(\n  bind_cols(x = 0.15, y = 1.2, \n    metric = \"Proficiency\", \n    median_hdi(prof_contrast, .value), \n    ROPE = rope(prof_contrast$.value, ci_method = \"HDI\")$ROPE_Percentage,\n    PD = p_direction(prof_contrast$.value)[[1]]\n    ), \n  bind_cols(x = -0.3, y = 2.2, \n    metric = \"Use\", \n    median_hdi(use_contrast, .value), \n    ROPE = rope(use_contrast$.value, ci_method = \"HDI\")$ROPE_Percentage,\n    PD = p_direction(use_contrast$.value)[[1]]\n    )\n  ) %>% \n  mutate(across(c(\".value\", \".lower\", \".upper\", \"PD\"), \n    ~ round(.x, digits = 2))) %>% \n  transmute(x, y, metric, contrast, \n    out = glue(\"β = {.value} [{.lower}, {.upper}]\\nROPE = {ROPE}, PD = {PD}\"))\n\nbind_rows(prof_contrast, use_contrast) %>% \n  mutate(ylab = if_else(metric == \"use\", \"Use\", \"Proficiency\")) %>% \n  ggplot(., aes(x = .value, y = ylab, fill = stat(abs(x) > 0.1))) + \n    geom_tile(data = tibble(\n      ylab = \"Proficiency\", value = 0, lower = -0.1, upper = 0.1\n      ),\n      aes(x = value, width = lower - upper),\n      alpha = 0.1, height = Inf, fill = \"#31688EFF\") +\n    geom_vline(xintercept = 0, lty = 3, size = 0.5) + \n    stat_dotsinterval(quantiles = 100, point_interval = \"median_hdi\", \n      show.legend = F, pch = 21, point_fill = \"white\") +\n    scale_fill_manual(values = c(\"grey\", \"#cc0033\")) + \n    coord_cartesian(xlim = c(-0.3, 0.3)) + \n    geom_text(data = use_prof_desc, aes(x = x, y = y, label = out), \n      hjust = 0, size = 3) +\n    labs(y = NULL, x = \"Marginal mean difference\\n(L2 - HS)\") + \n    theme(axis.text.y = element_text(angle = 90, hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](../figs/eda-prof-use-marginal-mean-estimates-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nn_groups <- prof_use_final %>% \n  mutate(group = str_replace_all(group, \"hl\", \"HS\")) %>% \n  group_by(group) %>% \n  summarize(n = n_distinct(id))\n\ntab_prof_use_desc <- prof_use_final %>% \n  mutate(group = str_replace_all(group, \"hl\", \"HS\")) %>% \n  group_by(group) %>% \n  summarize(across(c(\"prof_p\", \"use_p\"), \n    list(mean = mean, sd = sd))) %>% \n  mutate_if(is.numeric, specify_decimal, k = 2) %>% \n  left_join(., n_groups, by = \"group\") %>% \n  mutate(\n    Proficiency = glue(\"{prof_p_mean} ({prof_p_sd})\"), \n    Proficiency_prose = glue(\"{prof_p_mean} (SD = {prof_p_sd})\"), \n    Use = glue(\"{use_p_mean} ({use_p_sd})\"), \n    Use_prose = glue(\"{use_p_mean} (SD = {use_p_sd})\"), \n    ) %>% \n  transmute(Group = group, n, Proficiency, Use, Proficiency_prose, Use_prose) %>% \n  mutate(Group = str_to_upper(Group)) %>% \n  write_csv(here(\"tables\", \"tab_prof_use_desc.csv\"))\n\ntab_prof_use_desc %>% \n  select(-c(\"Proficiency_prose\", \"Use_prose\")) %>% \n  knitr::kable(format = \"pandoc\", \n    align = c(\"l\", \"r\", \"r\", \"r\"), \n    caption = \"Average use and proficiency for L2 and heritage learners.\")\n```\n\n::: {.cell-output-display}\nTable: Average use and proficiency for L2 and heritage learners.\n\nGroup     n   Proficiency           Use\n------  ---  ------------  ------------\nHS       42   0.70 (0.09)   0.41 (0.15)\nL2       50   0.71 (0.14)   0.38 (0.16)\n:::\n\n```{.r .cell-code}\ntab_use_prof_desc_mod <- use_prof_desc %>% \n  mutate(contrast = str_replace_all(contrast, \"hl\", \"hs\")) %>% \n  select(metric:out) %>% \n  separate(out, into = c(\"Estimate\", \"ROPE\"), sep = \"\\n\") %>% \n  separate(ROPE, into = c(\"ROPE\", \"PD\"), sep = \",\") %>% \n  mutate(contrast = str_to_upper(contrast), \n    Estimate = str_remove(Estimate, \"β = \"), \n    Estimate = str_replace_all(Estimate, \"-\", \"\\U2212\"), \n    PD = str_remove(PD, \"PD = \"), \n    ROPE = str_remove(ROPE, \"ROPE = \"), \n    PD = str_remove(PD, \" \")) %>% \n  select(Metric = metric, Contrast = contrast, Estimate, ROPE, PD) %>% \n  write_csv(here(\"tables\", \"tab_prof_use_mod.csv\"))\n\ntab_use_prof_desc_mod %>% \n  knitr::kable(format = \"pandoc\", \n    align = c(\"l\", \"l\", \"r\", \"r\", \"r\"), \n    caption = \"Marginal mean difference beween L2 and heritage leareners for use and proficiency.\")\n```\n\n::: {.cell-output-display}\nTable: Marginal mean difference beween L2 and heritage leareners for use and proficiency.\n\nMetric        Contrast               Estimate   ROPE     PD\n------------  ---------  --------------------  -----  -----\nProficiency   L2 - HS      0.02 [−0.03, 0.07]      1   0.77\nUse           L2 - HS     −0.02 [−0.09, 0.05]      1   0.72\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprof_use %>% \n  mutate(remove = if_else(id %in% remove, 1, 0)) %>% \n  write_csv(here(\"data\", \"tidy\", \"prof_use.csv\"))\n```\n:::\n",
    "supporting": [
      "02_eda_prof_use_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}